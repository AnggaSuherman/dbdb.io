# Clone the repository and checkout to the dev branch

# First, make sure to update MySQL-python
pip install -r requirements.txt

# Create a symlink for the static admin files
ln -s /usr0/local/lib/python2.7/dist-packages/django/contrib/admin/static/admin website/static/admin


####### Only need to do this once per mysql installation (Ubuntu instructions) #######
# Configure the mysql service (as root user) to use Barracuda for InnoDB, so ROW_FORMAT=DYNAMIC can be used
sudo su
printf '\n[mysqld]\ninnodb_file_format=Barracuda\n' >> /etc/mysql/my.cnf
service mysql restart
exit
################################################################

# To start from scratch, drop the database and recreate it:
mysqladmin drop -u <user> -p dbdb_io
mysqladmin create -u <user> -p dbdb_io

# IMPORTANT - To avoid issues with migrations if you already have migrations for this app:
# Delete all files from systems/migrations EXCEPT for the __init__.py and __init__.pyc files

# Apply migrations:
python manage.py makemigrations
python manage.py migrate

# To be able to fit the large rows in SystemVersion, apply this fix
mysql -u <user> -p -e 'use dbdb_io; alter table systems_systemversion ROW_FORMAT=DYNAMIC;'

# From the current_data folder run
python parse_system_data.py

# Load all fixtures - including new ones added by the parse_system_data script
# There will be some output saying which fields don't match if they aren't formatted 
# or written correctly.
python manage.py loaddata systems/fixtures/*

# Create the super user
python manage.py createsuperuser

# Start the server
python manage.py runserver
